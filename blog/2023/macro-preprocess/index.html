<!DOCTYPE html>
<html lang="en">

  <!-- Head -->
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">    <!-- Metadata, OpenGraph and Schema.org -->
    

    <!-- Standard metadata -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>C++ Preprocess Directives | Inno (Dong)  Jia</title>
    <meta name="author" content="Inno (Dong)  Jia">
    <meta name="description" content="Common-used preprocess directives in c++.">
    <meta name="keywords" content="Digital Twin, UAV, 6G">


    <!-- Bootstrap & MDB -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous">

    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">

    <!-- Code Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light">

    <!-- Styles -->
    
    <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;">
    
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="canonical" href="https://kobehub.github.io/blog/2023/macro-preprocess/">
    
    <!-- Dark Mode -->
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark">

    <script src="/assets/js/theme.js"></script>
    <script src="/assets/js/dark_mode.js"></script>
    



  </head>

  <!-- Body -->
  <body class="fixed-top-nav ">

    <!-- Header -->
    <header>

      <!-- Nav Bar -->
      <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
        <div class="container">
          <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Inno (Dong) </span>Jia</a>
          <!-- Navbar Toggle -->
          <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar top-bar"></span>
            <span class="icon-bar middle-bar"></span>
            <span class="icon-bar bottom-bar"></span>
          </button>

          <div class="collapse navbar-collapse text-right" id="navbarNav">
            <ul class="navbar-nav ml-auto flex-nowrap">

              <!-- About -->
              <li class="nav-item ">
                <a class="nav-link" href="/">about</a>
              </li>
              
              <!-- Blog -->
              <li class="nav-item active">
                <a class="nav-link" href="/blog/">blog<span class="sr-only">(current)</span></a>
              </li>

              <!-- Other pages -->
              <li class="nav-item ">
                <a class="nav-link" href="/cv/">cv</a>
              </li>

              <!-- Toogle theme mode -->
              <li class="toggle-container">
                <button id="light-toggle" title="Change theme">
                  <i class="fas fa-moon"></i>
                  <i class="fas fa-sun"></i>
                </button>
              </li>
            </ul>
          </div>
        </div>
      </nav>

      <!-- Scrolling Progress Bar -->
      <progress id="progress" value="0">
        <div class="progress-container">
          <span class="progress-bar"></span>
        </div>
      </progress>
    </header>


    <!-- Content -->
    <div class="container mt-5">
      <!-- _layouts/post.html -->

<div class="post">

  <header class="post-header">
    <h1 class="post-title">C++ Preprocess Directives</h1>
    <p class="post-meta">February 16, 2023</p>
    <p class="post-tags">
      <a href="/blog/2023"> <i class="fas fa-calendar fa-sm"></i> 2023 </a>
        ·  
        <a href="/blog/tag/cpp">
          <i class="fas fa-hashtag fa-sm"></i> cpp</a>  
          
        ·  
        <a href="/blog/category/cpp">
          <i class="fas fa-tag fa-sm"></i> cpp,</a>  
          <a href="/blog/category/programming">
          <i class="fas fa-tag fa-sm"></i> programming</a>  
          

    </p>
  </header>

  <article class="post-content">
    <p>I have recently joined a company that specializes in Quantitative Trading, where the primary languages used for development are C++ and Rust. Although I have not had prior experience working on a commercial C++ program, I wanted to share my recent encounter with C++ preprocess directives in this post.</p>

<h2 id="1-include-and-include_next">1. #include and #include_next</h2>

<p>#include is the most common-used directive in c/c++. It just searches the file and add targeted file’s content to current file. Normally, we include all header files(.h and .hpp) in our source files (.cc, .cpp, .cxx). Basic usage:∞</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;path-spec&gt;</span><span class="cp">
#include</span> <span class="cpf">"path-spec"</span><span class="cp">
</span></code></pre></div></div>

<p>The <em>path-spec</em> is a file name that may optionally be preceded by a directory specification. The file name must name an existing file. The syntax of the <em>path-spec</em> depends on the operating system on which the program is compiled.</p>

<p><code class="language-plaintext highlighter-rouge">#include_next</code> is a supportive directive in GUN c++. <code class="language-plaintext highlighter-rouge">#include_next</code> does not distinguish between &lt;file&gt; and “file” inclusion, nor does it check that the file you specify has the same name as the current file. It simply looks for the file named, starting with the directory in the search path after the one where the current file was found.</p>

<p>The use of `#include_next’ can lead to great confusion. We recommend it be used only when there is no other alternative. In particular, it should not be used in the headers belonging to a specific program; it should be used only to make global corrections along the lines of fixincludes.</p>

<p>Here are some scenarios we can use <code class="language-plaintext highlighter-rouge">#include_next</code>:</p>

<ul>
  <li>
    <p>If we want to replace a default header with our own making. If we want to replace <code class="language-plaintext highlighter-rouge">stblib.h</code>, we create a new file in our project and it contains a header “stdlib.h”. We can create a our lib in this way.</p>

    <div class="language-c++ highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="cp">#include_next "stdlib.h"
</span><span class="kt">int</span> <span class="nf">my_lib_func</span><span class="p">();</span>
</code></pre></div>    </div>

    <p>And the compiler will not include <em>your</em> stdlib.h again recursively, as would be the case with plain a #include, but rather continue in other directories for a file named “stdlib.h”.</p>
  </li>
  <li>
    <p>It’s handy if you’re supporting multiple versions of something. For example, I’m writing code that supports PostgreSQL 9.4 and 9.6. A number of internal API changes exist, mostly new arguments to existing functions. We can use the most up-to-date version header with <code class="language-plaintext highlighter-rouge">#include_next</code>.</p>
  </li>
</ul>

<h2 id="2-define-and-undef">2. #define and #undef</h2>

<p>The <strong>#define</strong> creates a <em>macro</em>, which is the association of an identifier or parameterized identifier with a token string. After the macro is defined, the compiler can substitute the token string for each occurrence of the identifier in the source file.</p>

<p>The <strong>#define</strong> directive causes the compiler to substitute <em>token-string</em> for each occurrence of <em>identifier</em> in the source file. The <em>identifier</em> is replaced only when it forms a token. That is, <em>identifier</em> is not replaced if it appears in a comment, in a string, or as part of a longer identifier.</p>

<p>One or more white-space characters must separate <em>token-string</em> from <em>identifier</em>. This white space is not considered part of the substituted text, nor is any white space that follows the last token of the text. But any token after token string will use to replace text;</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#define TEST 3;
</span><span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">TEST</span> <span class="c1">// a = 1 + 3;</span>
</code></pre></div></div>

<p>A <code class="language-plaintext highlighter-rouge">#define</code> without a <em>token-string</em> removes occurrences of <em>identifier</em> from the source file. The <em>identifier</em> remains defined and can be tested by using the <code class="language-plaintext highlighter-rouge">#if defined</code> and <code class="language-plaintext highlighter-rouge">#ifdef</code> directives.</p>

<p>The second syntax form defines a function-like macro with parameters. This form accepts an optional list of parameters that must appear in parentheses. After the macro is defined, each subsequent occurrence of <em>identifier</em>( <em>identifier</em>opt, …, <em>identifier</em>opt ) is replaced with a version of the <em>token-string</em> argument that has actual arguments substituted for formal parameters.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#define max(a,b) ( (a) &gt; (b) ? (a) : (b) )    // We need to add parentheses to each argument to ensure expression is correct.
</span><span class="kt">int</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="p">);</span>   
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">#undef</code> removes one identifier’s defination.</p>

<h2 id="3-conditions-if-ifdef">3. Conditions: #if, #ifdef</h2>

<p>There is a series of preprocess directives to control workflow. Conditional directives are mostly used in standard libraries to detect platforms and environment.</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#if constant-expression  // #ifdef or #ifndef
</span>      <span class="n">code</span>
<span class="cp">#elif constant-expression
</span>      <span class="n">code</span>
<span class="cp">#else
</span>      <span class="n">code</span>
<span class="cp">#endif
</span></code></pre></div></div>

<p>The <em>constant-expression</em> is an integer constant expression with these additional restrictions:</p>

<ul>
  <li>Expressions must have integral type and can include only integer constants, character constants, and the <strong>defined</strong> operator.</li>
  <li>The expression can’t use <strong><code class="language-plaintext highlighter-rouge">sizeof</code></strong> or a type-cast operator.</li>
  <li>The target environment may be unable to represent all ranges of integers.</li>
  <li>The translation represents type <strong><code class="language-plaintext highlighter-rouge">int</code></strong> the same way as type <strong><code class="language-plaintext highlighter-rouge">long</code></strong>, and <strong><code class="language-plaintext highlighter-rouge">unsigned int</code></strong> the same way as <strong><code class="language-plaintext highlighter-rouge">unsigned long</code></strong>.</li>
  <li>The translator can translate character constants to a set of code values different from the set for the target environment. To determine the properties of the target environment, use an app built for that environment to check the values of the <em>LIMITS.H</em> macros.</li>
  <li>The expression must not query the environment, and must remain insulated from implementation details on the target computer.</li>
</ul>

<p>In the following example, the <strong>#if</strong> and <strong>#endif</strong> directives control compilation of one of three function calls:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#if defined(CREDIT)
</span>    <span class="n">credit</span><span class="p">();</span>
<span class="cp">#elif defined(DEBIT)
</span>    <span class="n">debit</span><span class="p">();</span>
<span class="cp">#else
</span>    <span class="n">printerror</span><span class="p">();</span>
<span class="cp">#endif
</span></code></pre></div></div>

<p>The conditional compilation statements in the following example assume a previously defined symbolic constant named <code class="language-plaintext highlighter-rouge">DLEVEL</code>.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#if DLEVEL &gt; 5
</span>    <span class="cp">#define SIGNAL  1
</span>    <span class="cp">#if STACKUSE == 1
</span>        <span class="cp">#define STACK   200
</span>    <span class="cp">#else
</span>        <span class="cp">#define STACK   100
</span>    <span class="cp">#endif
#else
</span>    <span class="cp">#define SIGNAL  0
</span>    <span class="cp">#if STACKUSE == 1
</span>        <span class="cp">#define STACK   100
</span>    <span class="cp">#else
</span>        <span class="cp">#define STACK   50
</span>    <span class="cp">#endif
#endif
#if DLEVEL == 0
</span>    <span class="cp">#define STACK 0
#elif DLEVEL == 1
</span>    <span class="cp">#define STACK 100
#elif DLEVEL &gt; 5
</span>    <span class="n">display</span><span class="p">(</span> <span class="n">debugptr</span> <span class="p">);</span>
<span class="cp">#else
</span>    <span class="cp">#define STACK 200
#endif
</span></code></pre></div></div>

<h2 id="4-pragma">4. #pragma</h2>

<p>Pragma directives specify machine-specific or operating system-specific compiler features. A line that starts with <code class="language-plaintext highlighter-rouge">#pragma</code> specifies a pragma directive.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#pragma token-string
</span><span class="n">__pragma</span><span class="p">(</span> <span class="n">token</span><span class="o">-</span><span class="n">string</span> <span class="p">)</span> <span class="c1">// two leading underscores - Microsoft-specific extension</span>
<span class="n">_Pragma</span><span class="p">(</span> <span class="n">string</span><span class="o">-</span><span class="n">literal</span> <span class="p">)</span> <span class="c1">// C99</span>
</code></pre></div></div>

<p>Each implementation of C and C++ supports some features unique to its host machine or operating system. Some programs, for example, must exercise precise control over the location of data in memory, or control the way certain functions receive parameters. The <strong><code class="language-plaintext highlighter-rouge">#pragma</code></strong> directives offer a way for each compiler to offer machine- and operating system-specific features, while maintaining overall compatibility with the C and C++ languages.</p>

<h3 id="41-pragma-region">4.1 #pragma region</h3>

<p>This directive specifies the packing alignment for structure, union and class members.</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">#pragma pack(show)</code>: shows current byte value for packing alignment. The value is displayed by a warning message.</li>
  <li>
<code class="language-plaintext highlighter-rouge">#pragma pack(push, n)</code>: pushes the current packimg alignment value to internal compiler stack and set current packing alignment to <code class="language-plaintext highlighter-rouge">n</code>. If n is not specified, current packing alignment value is pushed.</li>
  <li>
<code class="language-plaintext highlighter-rouge">#pragma pack(pop, n)</code>: Removes the record from the top of internal compiler stack. If <code class="language-plaintext highlighter-rouge">n</code> isn’t specified with <code class="language-plaintext highlighter-rouge">pop</code>, then current packing alignment value is the top of the stack. If <code class="language-plaintext highlighter-rouge">n</code> is specified, <code class="language-plaintext highlighter-rouge">n</code> becomes the new packing alignment value.</li>
  <li>
<code class="language-plaintext highlighter-rouge">#pragma pack(n)</code>: specifies the packing alignment value. The default value is 8, available values include 1, 2, 4, 8, and 16. The alignment of a member is on a boundary that’s either a multiple of <em><code class="language-plaintext highlighter-rouge">n</code></em>, or a multiple of the size of the member, whichever is smaller.</li>
</ul>

<p>As for the push and pop, we can also assign one identifier to it. If you pop using an <em><code class="language-plaintext highlighter-rouge">identifier</code></em>, for example, <code class="language-plaintext highlighter-rouge">#pragma pack(pop, r1)</code>, then all records on the stack are popped until the record that has <em><code class="language-plaintext highlighter-rouge">identifier</code></em> is found. That record gets popped, and the packing value associated with the record found on the top of the stack becomes the new packing alignment value. If you pop using an <em><code class="language-plaintext highlighter-rouge">identifier</code></em> that isn’t found in any record on the stack, then the <strong><code class="language-plaintext highlighter-rouge">pop</code></strong> is ignored.</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// pragma_directives_pack_2.cpp</span>
<span class="c1">// compile with: /W1 /c</span>
<span class="cp">#pragma pack()   // n defaults to 8; equivalent to /Zp8
#pragma pack(show)   // C4810
#pragma pack(4)   // n = 4
#pragma pack(show)   // C4810
#pragma pack(push, r1, 16)   // n = 16, pushed to stack
#pragma pack(show)   // C4810
</span>
<span class="c1">// pop to the identifier and then set</span>
<span class="c1">// the value of the current packing alignment:</span>
<span class="cp">#pragma pack(pop, r1, 2)   // n = 2 , stack popped
#pragma pack(show)   // C4810
</span></code></pre></div></div>

<h3 id="41-pragma-once">4.1 <code class="language-plaintext highlighter-rouge">#pragma once</code>
</h3>

<p>This directive specifies that the compiler includes this header file only once, while compiling a source file.</p>

<p>The use of <code class="language-plaintext highlighter-rouge">#pragma once</code> can reduce build times, as the compiler won’t open and read the file again after the first <code class="language-plaintext highlighter-rouge">#include</code> of the file in the translation unit. It’s called the <em>multiple-include optimization</em>. We can also use include guard idiom, which puts around the entirety of the header file:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// point.hpp</span>
<span class="cp">#ifndef MYPROJECT_POINT_HPP_GUARD
#define MYPROJECT_POINT_HPP_GUARD
</span><span class="k">struct</span> <span class="nc">point</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">;</span>
<span class="p">};</span>
<span class="cp">#endif
</span></code></pre></div></div>

<p>We recommend the <code class="language-plaintext highlighter-rouge">#pragma once</code> directive for new code because it doesn’t pollute the global namespace with a preprocessor symbol. It requires less typing, it’s less distracting, and it can’t cause <em>symbol collisions</em>. Symbol collisions are errors caused when different header files use the same preprocessor symbol as the guard value. It isn’t part of the C++ Standard, but it’s implemented portably by several common compilers.</p>

<h2 id="5-_attribute_">5. _<em>attribute_</em>
</h2>

<h2 id="6-__declspec">6. __declspec</h2>


  </article><div id="giscus_thread" style="max-width: 800px; margin: 0 auto;">
  <script>
    let giscusTheme = localStorage.getItem("theme");
    let giscusAttributes = {
        "src": "https://giscus.app/client.js",
        "data-repo": "kobeHub/kobehub.github.io",
        "data-repo-id": "MDEwOlJlcG9zaXRvcnkxNjQyMzA0MjU=",
        "data-category": "Comments",
        "data-category-id": "DIC_kwDOCcn1Gc4CUFvv",
        "data-mapping": "title",
        "data-strict": "1",
        "data-reactions-enabled": "1",
        "data-emit-metadata": "0",
        "data-input-position": "bottom",
        "data-theme": giscusTheme,
        "data-lang": "en",
        "crossorigin": "anonymous",
        "async": "",
    };


    let giscusScript = document.createElement("script");
    Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value));
    document.getElementById("giscus_thread").appendChild(giscusScript);
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by giscus.</a>
</noscript>
</div>
</div>

    </div>

    <!-- Footer -->    
    <footer class="fixed-bottom">
      <div class="container mt-0">
        © Copyright 2025 Inno (Dong)  Jia. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>.

      </div>
    </footer>

    <!-- JavaScripts -->
    <!-- jQuery -->
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

    <!-- Bootsrap & MDB scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script>

    <!-- Masonry & imagesLoaded -->
  <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
  <script defer src="/assets/js/masonry.js" type="text/javascript"></script>
    
  <!-- Medium Zoom JS -->
  <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script>
  <script defer src="/assets/js/zoom.js"></script><!-- Load Common JS -->
  <script defer src="/assets/js/common.js"></script>

    
  <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script>
  <script async src="https://badge.dimensions.ai/badge.js"></script>

    <!-- MathJax -->
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        tags: 'ams'
      }
    };
  </script>
  <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js"></script>
  <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>

    
    

<!-- Scrolling Progress Bar -->
<script type="text/javascript">
  /*
   * This JavaScript code has been adapted from the article 
   * https://css-tricks.com/reading-position-indicator/ authored by Pankaj Parashar, 
   * published on the website https://css-tricks.com on the 7th of May, 2014.
   * Couple of changes were made to the original code to make it compatible 
   * with the `al-foio` theme.
   */
  const progressBar = $("#progress");
  /*
   * We set up the bar after all elements are done loading.
   * In some cases, if the images in the page are larger than the intended
   * size they'll have on the page, they'll be resized via CSS to accomodate
   * the desired size. This mistake, however, breaks the computations as the
   * scroll size is computed as soon as the elements finish loading.
   * To account for this, a minimal delay was introduced before computing the
   * values.
   */
  window.onload = function () {
    setTimeout(progressBarSetup, 50);
  };
  /*
   * We set up the bar according to the browser.
   * If the browser supports the progress element we use that.
   * Otherwise, we resize the bar thru CSS styling
   */
  function progressBarSetup() {
    if ("max" in document.createElement("progress")) {
      initializeProgressElement();
      $(document).on("scroll", function() {
        progressBar.attr({ value: getCurrentScrollPosition() });
      });
      $(window).on("resize", initializeProgressElement);
    } else {
      resizeProgressBar();
      $(document).on("scroll", resizeProgressBar);
      $(window).on("resize", resizeProgressBar);
    }
  }
  /*
   * The vertical scroll position is the same as the number of pixels that
   * are hidden from view above the scrollable area. Thus, a value > 0 is
   * how much the user has scrolled from the top
   */
  function getCurrentScrollPosition() {
    return $(window).scrollTop();
  }

  function initializeProgressElement() {
    let navbarHeight = $("#navbar").outerHeight(true);
    $("body").css({ "padding-top": navbarHeight });
    $("progress-container").css({ "padding-top": navbarHeight });
    progressBar.css({ top: navbarHeight });
    progressBar.attr({
      max: getDistanceToScroll(),
      value: getCurrentScrollPosition(),
    });
  }
  /*
   * The offset between the html document height and the browser viewport
   * height will be greater than zero if vertical scroll is possible.
   * This is the distance the user can scroll
   */
  function getDistanceToScroll() {
    return $(document).height() - $(window).height();
  }

  function resizeProgressBar() {
    progressBar.css({ width: getWidthPercentage() + "%" });
  }
  // The scroll ratio equals the percentage to resize the bar
  function getWidthPercentage() {
    return (getCurrentScrollPosition() / getDistanceToScroll()) * 100;
  }
</script>

  </body>
</html>
